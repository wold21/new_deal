3

2021 / 04 / 14 



\+  í”„ë¡œì íŠ¸ í™˜ê²½

JDK          : 1.8
  Spring      : 4.1.2
  DBMS      : Mysql 5.5
  jquery     :  1.11.2

JSTL
MyBatis3
Vue.JS3
Html5
Ajax

í•œë‹¬ì •ë„ 1ì¸ë‹¹ 3~4íŽ˜ì´ì§€ ì •ë„ ìž‘ì—…í•  ê²ƒìž„.



\+ ì–´ì œí–ˆë˜ ì¿¼ë¦¬ë¬¸



**ìœ ì €íƒ€ìž…ì´ Cì¸ ì‚¬ëžŒì´ ì ‘ê·¼í•  ìˆ˜ ìžˆëŠ” ë©”ë‰´ IDì™€ ë©”ë‰´ëª…**

~~~mysql
select mm.MNU_ID , mm.MNU_NM
  from tn_usr_mnu_atrt ma 
       left outer join tm_mnu_mst mm on ma.MNU_ID = mm.MNU_ID 
 where ma.user_type  = 'C';
~~~

1. Inner join ì‚¬ìš©

```mysql
select ma.MNU_ID, mm.MNU_NM 
	from tn_usr_mnu_atrt ma 
    inner join tm_mnu_mst mm on ma.MNU_ID = mm.MNU_ID
	where ma.user_type = 'C';
```

2. Whereë³´ë‹¤ andë¡œ ì ëŠ” ê²ƒì´ íš¨ìœ¨ì´ ì¢‹ìŒ. ê³„ì‚°í• ê²ƒì„ ì¤„ì´ê³  ë„˜ì–´ê°€ê¸° ë•Œë¬¸

```mysql
select mm.MNU_ID, mm.MNU_NM
	from tn_usr_mnu_atrt ma
		left outer join tm_mnu_mst mm on ma.MNU_ID = mm.MNU_ID and ma.user_type = 'C';
```





**dbserverì‚¬ìš©ìžê°€ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ë©”ë‰´IDì™€ ë©”ë‰´ëª…**

```mysql
select ll.MNU_ID , ll.MNU_NM
  from tb_userinfo ui 
       left outer join (
                           select mm.MNU_ID , mm.MNU_NM, ma.user_type
                             from tm_mnu_mst mm  
                           inner join tn_usr_mnu_atrt ma on ma.MNU_ID = mm.MNU_ID 
                       ) ll on ll.user_type = ui.user_Type 
 where ui.loginId = 'dbserver'
```

```mysql
select mm.MNU_ID, mm.MNU_NM
  from tn_usr_mnu_atrt ma
	     left outer join tm_mnu_mst mm on ma.MNU_ID = mm.MNU_ID 
									 								and ma.user_type = (
																												select user_type
																													from tb_userinfo
															 													 where loginId = 'dbserver'
																											);
```

```mysql
select mm.MNU_ID, mm.MNU_NM
  from tn_usr_mnu_atrt ma
	     left outer join tm_mnu_mst mm on ma.MNU_ID = mm.MNU_ID 
									 								and ma.user_type in (
																												select user_type
																													from tb_userinfo
															 													 where loginId = 'dbserver'
																											);
```





## âœ‰ï¸ SubQuery

- ì¿¼ë¦¬ë¬¸ì—ì„œ ì œì¼ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„
- ë¹„êµëŒ€ìƒì˜ ìž‘ì—… ê±´ìˆ˜ë¥¼ ìµœëŒ€í•œ ì¤„ì—¬ë¼.
- ì–´ëŠ í…Œì´ë¸”ì´ ê¸°ì¤€ì¸ì§€ íŒë‹¨ì„ í•´ì•¼í•œë‹¤.
- ë¨¼ì € FROMì ˆë¶€í„° ì ê³  Joinì ˆ -> ì¡°ê±´ì ˆ -> SELECT ìˆœìœ¼ë¡œ ìž‘ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- inner joinìœ¼ë¡œ í•´ë„ ëœë‹¤.
- ì¶”ê°€ì ìœ¼ë¡œ ìž‘ì—…í•´ì•¼í•  ê²ƒì´ ìžˆì„ ë•Œ 'where'ì„ ì‚¬ìš©í•œë‹¤. ì•„ë‹ˆë¼ë©´ andë¬¸ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- ì•„ëž˜ì™€ ê°™ì´ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ìž‘ì—… í•  ìˆ˜ ìžˆë‹¤.
- ê°ê° ë¨¼ì € ì‹¬í”Œí•œ ì„œë¸Œì¿¼ë¦¬ë¡œ selectë¥¼ í•´ì˜¤ê³  ê·¸ê²ƒì„ í•©ì³ì„œ ìµœì¢…ì ìœ¼ë¡œ í•„ìš”í•œ selectë¥¼ ì ëŠ”ë‹¤.
- ëª¨ë“  ì ˆì— ì„œë¸Œì¿¼ë¦¬ ìž‘ì„± ê°€ëŠ¥í•˜ë‹¤. 
  - ë‹¤ë§Œ fromì„ ì œì™¸í•œ ì ˆì— ìž‘ì„±í•˜ë©´ ì¿¼ë¦¬ í¼í¬ë¨¼ìŠ¤ê°€ êµ‰ìž¥ížˆ ë‚®ì•„ì§„ë‹¤.
  - selectì•ˆ ì„œë¸Œì¿¼ë¦¬ì˜ select ì ˆì—ëŠ” ë°ì´í„° ê±´ìˆ˜ê°€ ë§Žìœ¼ë©´ ì‚¬ìš© x
  - whereì ˆì—ëŠ” ì—°ì‚°ìžì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ(ex. In) ì›¬ë§Œí•˜ë©´ ì‚¬ìš© x
  - ì•„ë¬´íŠ¼ ê±´ìˆ˜ê°€ ì ë‹¤ë©´ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.
  - ë§Œì•½ select in selectë¥¼ ì‚¬ìš©í•´ì•¼ í• ê²½ìš°ì—ëŠ” Joinë¬¸ìœ¼ë¡œ ë„˜ê¸°ìž.



#### ì¿¼ë¦¬ ê¸°ë³¸

SELECT

FROM

WHERE

GROUP BY : ê·¸ë£¹í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê¸°ì¤€ì„ ìž¡ê¸° ìœ„í•œ ìš©ë„, ì—¬ê¸°ì— ì ì€ ì»¬ëŸ¼ì€ ë°˜ë“œì‹œ selectë¬¸ì— í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.

ORDER BY : ê¸°ë³¸ ì˜¤ë¦„ì°¨ìˆœ, ë‚´ë¦¼ì°¨ìˆœì€ desc(ì»¬ëŸ¼ë’¤ì— ë‹¤ ì ì–´ì¤˜ì•¼í•¨.)

HAVING : GROUP BYì™€ ìŒìœ¼ë¡œ ì›€ì§ì´ë©° ê·¸ë£¹í•¨ìˆ˜ ê²°ê³¼ì— ì¡°ê±´ì„ ê±¸ë•Œ ì‚¬ìš©í•¨



## MAX + 1

ì‚¬ì´íŠ¸ ì‹ ê·œê¸€ ìž‘ì„±í•  ë•Œ Pkë¥¼ ë¶€ì—¬í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ ì“°ê¸°ë„í•¨. 

í•˜ì§€ë§Œ ë™ì‹œì— ê¸€ì„ ìž‘ì„±í•˜ë©´ íŠ¸ëžœìž­ì…˜ì´ ìƒê¸¸ ê°€ëŠ¥ì„±ì´ ìžˆê¸°ë•Œë¬¸ì— ìœ ì˜í•´ì•¼í•œë‹¤.

í•´ê²°ì±…ì€ squenceë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ì˜¤ë¼í´ì—ëŠ” ì‹œí€€ìŠ¤ê°€ ì¡´ìž¬í•˜ì§€ë§Œ MySQLì€ ì¡´ìž¬í•˜ì§€ ì•Šê¸°ì— ì‹œí€€ìŠ¤ ê¸°ëŠ¥ì„ í•˜ëŠ” í…Œì´ë¸”ì„ ë”°ë¡œ ìž‘ì„±í•´ì•¼í•œë‹¤.

- í•´ë‹¹ ê´€ë ¨ ë§í¬ [----> Blog <----](https://velog.io/@inyong_pang/MySQL-MySQL-Sequence-%EB%A7%8C%EB%93%A4%EA%B8%B0)

- ì˜¤ë¼í´ ì‹œí€€ìŠ¤ì— ëŒ€í•œ ê¸€ [----> Blog <----](https://coding-factory.tistory.com/420)



**<ì˜ˆì œ>**

```java
<insert id="insertMnu">
      /* kr.kosmo.jobkorea.system.dao.MnuMgrDao.insertMnu */
       <selectKey resultType="string" keyProperty="menuID" order="BEFORE">
            SELECT CONCAT('M', LPAD(IFNULL(CAST(SUBSTR(MAX(mnu_id),2,4) AS UNSIGNED),0)+1, 4, '0'))  FROM tm_mnu_mst
        </selectKey>   
      INSERT INTO tm_mnu_mst
      (
            mnu_id
         , hir_mnu_id
         , mnu_nm
         , mnu_url
         , mnu_dvs_cod
         , grp_num
         , odr
         , lvl
         <if test ="mnu_ico_cod != null and mnu_ico_cod != ''">
         , mnu_ico_cod
         </if>
         , use_poa
         , fst_enlm_dtt
         , fst_rgst_sst_id
         , fnl_mdfd_dtt
         , fnl_mdfr_sst_id
         , mem_author
      )
      
      VALUES
      (
            #{menuID}
         <choose>
            <when test ="hir_mnu_id != null and hir_mnu_id != ''">
               , #{hir_mnu_id}
            </when>
            <otherwise>
               , #{menuID}
            </otherwise>
         </choose>
         , #{mnu_nm}
         , #{mnu_url}
         , #{mnu_dvs_cod}
         <choose>
            <when test ="grp_num != null and grp_num != ''">
               , #{grp_num}
            </when>
            <otherwise>
               , (SELECT MAX(A.GRP_NUM) + 1 FROM tm_mnu_mst A )
            </otherwise>
         </choose>
         , #{odr}
         , #{lvl}
         <if test ="mnu_ico_cod != null and mnu_ico_cod != ''">
         , #{mnu_ico_cod}
         </if>
         , #{use_poa}
         , NOW()
         , #{fst_rgst_sst_id}
         , NOW()
         , #{fnl_mdfr_sst_id}
         , #{mem_author}
      )      
   </insert>
```





## ðŸ“ƒ Plan / Hint

### Plan

- SQLë¬¸ì˜ ì•¡ì„¸ìŠ¤ ê²½ë¡œë¥¼ í™•ì¸í•˜ê³  íŠœë‹í•  ìˆ˜ ìžˆë„ë¡ SQLë¬¸ì„ ë¶„ì„í•˜ê³  í•´ì„í•˜ì—¬ ì–´ë–»ê²Œ ì‹¤í–‰ í•  ê²ƒì¸ê°€ì— ëŒ€í•œ ê³„íš

- DBMSê°€ ì¿¼ë¦¬ë¬¸ì„ íŒŒì‹±í•´ì„œ ì–´ë–»ê²Œ ê°’ì„ ê°€ì ¸ì˜¬ì§€ì— ëŒ€í•œ ê³„íš
  - Mysql workbench ë™ìž‘ í”Œëžœ ë§í¬ [Link](https://engineering.linecorp.com/ko/blog/mysql-workbench-visual-explain-index/)
  - Oracle ê¸°ì¤€ Planing Link [Link](https://swjeong.tistory.com/143)

### Hint

-  Planì´ ì‹¤í–‰ ê²½ë¡œì˜€ë‹¤ë©´ HintëŠ” ì‹¤í–‰ ê²½ë¡œë¥¼ ì‚¬ìš©ìžê°€ ì§ì ‘ ì„¤ì •í•˜ëŠ” ê²ƒì´ë‹¤.
- ìš”ì¦˜ì—” í•˜ë“œì›¨ì–´ê°€ ì¢‹ì•„ì ¸ì„œ ë§Žì´ ì‚¬ìš©í•˜ê³  ìžˆì§€ëŠ” ì•Šë‹¤.
- ë§Œì•½ ížŒíŠ¸ì— ì˜¤íƒ€ê°€ ìžˆë‹¤ë©´ ê·¸ ë¬¸ì€ ë¬´ì‹œë˜ê³  ë„˜ì–´ê°€ê²Œ ëœë‹¤.
- Hintë¥¼ ì¸ë±ìŠ¤ì— í™œìš©í•˜ëŠ” ë°©ë²•
  - [Link](https://blog.acronym.co.kr/270)



**\+ ê·¸ëŸ¬ë‚˜ SQLë¬¸ì„ ëª‡ì²œì¤„ê¹Œì§€ ì¨ì•¼í•œë‹¤ë©´ Planê³¼ Hintë¥¼ ì‚¬ìš©í•´ 'íŠœë‹'ì„ í•´ì•¼í•œë‹¤.**



## ðŸ”‘ PK, FK, UK

### PK(Primary Key)

- ì‹ë³„ìž ì—­í• 
- Not Null
- ì¤‘ë³µ X -> Unique



### FK

- SQL Constraint ì°¸ê³  ë¸”ë¡œê·¸
  - [Link](https://superkong1.tistory.com/34)
- ë§Œì•½ PKì™€ ì¼ë°˜ ì»¬ëŸ¼ì˜ FKë¡œ ì—°ê²°ë˜ì–´ ìžˆë‹¤ë©´ ë¹„ì‹ë³„ ê´€ê³„ë¼ê³  í•œë‹¤.
  - í‘œì‹œëŠ” ì ì„ ì´ë‹¤.
- ë‘˜ë‹¤ PKì™€ PKë¼ë©´ ì‹ë³„ê´€ê³„ì´ë‹¤. 
  - í‘œì‹œëŠ” ì‹¤ì„ ì´ë‹¤.
- ì°¸ê³  ë¸”ë¡œê·¸
  - [Link](https://velog.io/@jch9537/DATABASE-%EC%8B%9D%EB%B3%84%EA%B3%BC-%EB%B9%84%EC%8B%9D%EB%B3%84-%EA%B4%80%EA%B3%84)



### UK

- ì˜ˆì „ì—ëŠ” ë§Žì´ ì¨ë¨¹ì—ˆëŠ”ë° ìš”ì¦˜ì—” ìž˜ ì“°ì§€ ì•ŠëŠ”ë‹¤.
- Uniqueí•˜ì§€ë§Œ Nullì„ í—ˆìš©í•œë‹¤.



### ì‹ë³„ê´€ê³„

- ë¶€ëª¨í…Œì´ë¸”ì˜ PKê°€ ìžì‹ í…Œì´ë¸”ì˜ FKì´ìž PKë¡œ ì‚¬ìš©ë˜ëŠ” ê´€ê³„
- ìžì‹ í…Œì´ë¸”ì— í–‰ì„ ì¶”ê°€í•  ë•Œ ë¶€ëª¨í…Œì´ë¸”ì˜ ì°¸ì¡° í–‰ì´ ì—†ë‹¤ë©´ ìžì‹ í…Œì´ë¸”ì˜ í–‰ì„ ì¶”ê°€ í•  ìˆ˜ ì—†ë‹¤.
- ì˜ˆë¥¼ë“¤ë©´ ê²Œì‹œíŒì˜ ìž‘ì„±ê¸€ê³¼ ëŒ“ê¸€ì˜ ê´€ê³„ì´ë‹¤.  

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-04-14 á„‹á…©á„’á…® 3.51.32](https://tva1.sinaimg.cn/large/008eGmZEly1gpj9yzd17ij30kz05pgma.jpg)



### ë¹„ì‹ë³„ê´€ê³„

- ë¶€ëª¨ í…Œì´ë¸”ì„ ì°¸ì¡°í•œ í…Œì´ë¸”ì—ì„œ ì°¸ì¡°ëœ FKê°€ ê¸°ë³¸í‚¤ê°€ ì•„ë‹Œ ì¼ë°˜ ì»¬ëŸ¼ì´ë‚˜ FKë¡œ ì°¸ì¡° ë˜ì—ˆì„ ë•Œë¥¼ ë§í•œë‹¤.
- ìžì‹ í…Œì´ë¸”ì˜ í–‰ì„ ì¶”ê°€í•  ë•Œ ë¶€ëª¨ í…Œì´ë¸”ì˜ ì°¸ì¡° í–‰ì´ ì—†ì–´ë„ í–‰ ì¶”ê°€ê°€ ê°€ëŠ¥í•˜ë‹¤.
- ì˜ˆë¥¼ ë“¤ë©´ íšŒì‚¬ì˜ ë¶€ì„œì™€ ì‚¬ì›ì˜ ê´€ê³„ë¥¼ ë¹„ì‹ë³„ ê´€ê³„ë¼ê³  í•  ìˆ˜ ìžˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-04-14 á„‹á…©á„’á…® 3.54.32](https://tva1.sinaimg.cn/large/008eGmZEly1gpja211cmsj30ju04yt9f.jpg)



\+

pkëŠ” ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ”ë° ë§Œì•½ í…Œì´ë¸”ì— pkê°€ ë§Žë‹¤ë©´ pkë¥¼ ëª¨ë‘ ë¬¶ì–´ì„œ ì¸ë±ìŠ¤ë¥¼ ì„¤ì •í•œë‹¤.

ë§Œì•½ ì¼ë°˜ ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ë¡œ ì§ì ‘ ìž¡ëŠ”ë‹¤ë©´ pkì˜ ì¸ë±ìŠ¤ê³¼ ë‹¤ë¥¸ê³³ì— ì¸ë±ìŠ¤ê°€ ìƒì„±ëœë‹¤. 

ì¸ë±ìŠ¤ë¥¼ ì“°ë©´ ê²€ìƒ‰ì†ë„ê°€ ë¹¨ë¼ì§„ë‹¤. ë‹¨ì§€ ë°ì´í„°ê°€ ì¤‘ê°„ì— ì¸ì„œíŠ¸, delete, updateë¥¼ í•  ì‹œì— 

ì¸ë±ìŠ¤ë¥¼ ìž¬ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ì†ë„ê°€ ëŠë ¤ì§„ë‹¤. 





## Index ì‚¬ìš©ì´ìœ 

Link - [----> Blog <----](https://velog.io/@gillog/SQL-Index%EC%9D%B8%EB%8D%B1%EC%8A%A4)

